"use strict";angular.module("fictionalApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngRoute","chart.js","contenteditable"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/login",{title:"Login - Fictional project",templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/register",{title:"Register - Fictional project",templateUrl:"views/register.html",controller:"RegisterCtrl",controllerAs:"register"}).when("/chart",{templateUrl:"views/comparative-chart.html",controller:"ChartCtrl",controllerAs:"chart"}).otherwise({redirectTo:"/"})}]),angular.module("fictionalApp").controller("MainCtrl",["$scope",function(a){a.logged=!sessionStorage.token,$(".alert-danger").slideUp()}]),angular.module("fictionalApp").controller("LoginCtrl",["$scope","$http","$location",function(a,b,c){sessionStorage.token&&c.path("/dashboard"),a.authenticate=function(){b({method:"POST",url:"http://ec2-54-149-67-9.us-west-2.compute.amazonaws.com/login",data:{email:$("#email").val(),password:$("#password").val()}}).then(function(a){sessionStorage.user_id=a.data._id,$(".alert-danger").slideUp(),c.path("/dashboard")},function(a){if(401===a.status)var b="Wrong user and password combination.";$(".alert-danger span").html(b||"").parent().slideDown(),setTimeout(function(){$(".alert-danger").slideUp()},5e3)})}}]),angular.module("fictionalApp").controller("DashboardCtrl",["$scope","$http","Question","$q",function(a,b,c,d){function e(a){var b=[];return a.map(function(a){var c={answers:[],pickedCounts:[]};a.answers.map(function(a){a.answer&&a.pickedCount&&!isNaN(a.pickedCount)&&(c.answers.push(a.answer),c.pickedCounts.push(a.pickedCount))}),b.push(c)}),b}a.colors=["rgba(151,187,205,1)","rgba(220,220,220,1)","rgba(247,70,74,1)","rgba(70,191,189,1)","rgba(253,180,92,1)","rgba(148,159,177,1)","rgba(77,83,96,1)"],a.editMode=!1;var f=[],g="";c.get(function(b){b[0]&&(b=b[0],b._id&&(g=b._id)),a.questions=f=b.questions||[],a.chartData=e(b.questions||[])},function(a){$(".alert-danger span").html(a.data.message).parent().slideDown(),setTimeout(function(){$(".alert-danger").slideUp()},5e3)}),a.calculatePercentage=function(a,b){var c=0,d=0;return a.map(function(a){c+=+a}),d=(b/c*100).toFixed(1),isNaN(d)?"":d+"%"},a.addQuestion=function(){var b={question:"Enter your question here!",answers:[]};a.questions.push(b),angular.element("html, body").animate({scrollTop:angular.element(document).height()},500)},a.removeQuestion=function(b){a.questions.splice(b,1)},a.addAnswer=function(b){a.questions[b].answers.push({}),a.updateCharts()},a.removeAnswer=function(b,c){a.questions[c].answers.splice(b,1),a.updateCharts()},a.updateCharts=function(){a.chartData=e(a.questions)},a.$on("edit-mode",function(b,c){a.editMode=!a.editMode}),a.$on("add-question",function(b,c){a.addQuestion()}),a.$on("refresh",function(b,c){a.updateCharts()}),a.$on("save-changes",function(c,d){a.questions.map(function(a){a.answers=a.answers.filter(function(a){return a.answer})});var e={method:"PUT",url:"http://ec2-54-149-67-9.us-west-2.compute.amazonaws.com/questions/",data:{_id:g||"578bdb5c19ee7c0844fd76c4",questions:a.questions}};b(e).then(function(b){a.updateCharts(),$(".alert-success span").html("Changes successfully saved!").parent().slideDown(),setTimeout(function(){$(".alert-success").slideUp()},2500)},function(a){console.log(a)})})}]),angular.module("fictionalApp").controller("RegisterCtrl",["$scope","$location","Users",function(a,b,c){$(".alert").slideUp(),sessionStorage.token&&b.path("/dashboard"),a.signup=function(){new c({email:$(".register-form #email").val(),password:$(".register-form #password").val(),name:$(".register-form #name").val()}).$save(function(a){$(".alert-info span").html("Congrats, "+a.name+". Your account has been registered.").parent().slideDown(),$(".alert-danger").slideUp(),b.path("/"),setTimeout(function(){$(".alert-info").slideUp()},5e3)},function(a){if(console.log(a),422===a.status){var b="";if(11e3===a.data.code)b="This email is already used, pick another one.";else if(12===a.data.code)b="Password is required.";else{var c=Object.keys(a.data.errors);b=c.join(", ")+" are required."}}$(".alert-danger span").html(b).parent().slideDown()})}}]),angular.module("fictionalApp").service("Users",["$resource",function(a){var b={post:{headers:{Accepts:"application/json"}}};return a("http://ec2-54-149-67-9.us-west-2.compute.amazonaws.com/user/",{},b)}]),angular.module("fictionalApp").controller("NavbarCtrl",["$scope","$http","$location","$rootScope",function(a,b,c,d){a.$on("$locationChangeSuccess",function(){sessionStorage.user_id?(a.templateUrl="views/template/navbarlogged.html",a.logout=function(){b({method:"GET",headers:{user_id:sessionStorage.user_id},url:"http://ec2-54-149-67-9.us-west-2.compute.amazonaws.com/logout/"+sessionStorage.user_id}).then(function(){delete sessionStorage.user_id,c.path("/"),d.$broadcast("logout"),a.templateUrl="views/template/navbar.html"},function(b){delete sessionStorage.user_id,c.path("/"),a.templateUrl="views/template/navbar.html",$(".alert-danger span").html(b.data.message).parent().slideDown(),setTimeout(function(){$(".alert-danger").slideUp()},5e3)})}):(a.templateUrl="views/template/navbar.html",a.logout=null)})}]),angular.module("fictionalApp").service("Question",["$resource",function(a){var b={post:{headers:{Accepts:"application/json"}}},c={get:{isArray:!0}};return a("http://ec2-54-149-67-9.us-west-2.compute.amazonaws.com/questions/",{},c,b)}]),angular.module("fictionalApp").controller("ActionsCtrl",["$scope","$rootScope","$location",function(a,b,c){a.editMode=!1,a.$on("$locationChangeSuccess",function(){a.loggedIn=!!sessionStorage.user_id&&"/"===c.path()}),a.$on("logout",function(){a.loggedIn=!1}),a.toggleEditMode=function(){a.editMode=!a.editMode,b.$broadcast("edit-mode")},a.addQuestion=function(){b.$broadcast("add-question")},a.refresh=function(){b.$broadcast("refresh")},a.saveChanges=function(){b.$broadcast("save-changes")}}]),angular.module("fictionalApp").controller("ChartCtrl",["$scope",function(a){a["default"]=[["Electrical Production","Night and day","Everyday","24 hours"],["Cost","₡ 10000 - ₡ 20000.","1) DIY Box Large: €649,99. The equivalent of 25 plant batteries. 2) DIY Box Home: €134,99. The equivalent of 5 plant batteries.","None, you only can support with donations."],["Charge","One product has enought energy for a normal room without excess.","One plant battery charges an smarth phone without problem while the plant baterry are working fine.","It's very small only allows up to 2 to 3 charges of an smart phone per day with a power: 5.0V, 1.9A."]],a.data=a["default"],a.deleteColumn=function(b){var c=-1;a.data.map(function(a){return-1!==a.indexOf(b)&&(c=a.indexOf(b)),c>0&&(angular.element("table").find("th").each(function(a,b){a===c&&angular.element(b).hide()}),a.splice(c,1)),a})}}]),angular.module("fictionalApp").directive("autoGenerate",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){function e(d){isNaN(+c.html())||a(function(){b.updateCharts()},200)}c.on("keyup",e)}}}]),angular.module("fictionalApp").run(["$templateCache",function(a){a.put("views/comparative-chart.html",'<table class="table table-striped table-hover"> <thead class="thead-inverse"> <tr> <th> Caracteristica </th> <th> Ours </th> <th> Plant-e </th> <th> bioo Lite </th> </tr> </thead> <tbody> <tr ng-repeat="product in data"> <td ng-repeat="column in product track by $index"> {{column}} </td> </tr> </tbody> </table>'),a.put("views/dashboard.html",'<div class="questionEntry" ng-repeat="question in questions track by $index"> <div class="question {{editMode ? \'editable\' : \'\'}}" contenteditable="{{editMode}}" ng-model="question.question"></div> <div ng-if="!question.answers.length" class="no-answers"> No answers added! </div> <div ng-if="question.answers.length"> <canvas class="chart chart-doughnut" chart-data="chartData[$index].pickedCounts" chart-labels="chartData[$index].answers"></canvas> <div class="answers"> <table> <tr class="headers"> <th>Answer</th> <th>Responses</th> <th>Percentage</th> </tr> <tr ng-repeat="answer in question.answers" style="background-color: {{colors[$index]}}"> <td contenteditable="{{editMode}}" ng-model="answer.answer"></td> <td class="picked" contenteditable="{{editMode}}" ng-model="answer.pickedCount" auto-generate></td> <td>{{calculatePercentage(chartData[$parent.$index].pickedCounts, answer.pickedCount)}}</td> <td ng-if="editMode" class="delete-answer"><span ng-click="removeAnswer($index, $parent.$parent.$parent.$index)" title="Remove \'{{answer.answer}}\'?" class="glyphicon glyphicon-trash" aria-hidden="true"></span></td> </tr> </table> </div> <br> </div> <a ng-if="editMode" class="btn btn-primary" ng-click="addAnswer($index)">Add answer</a> <a ng-if="editMode" class="btn btn-danger" ng-click="removeQuestion($index)">Delete question</a> <hr> </div> <div ng-if="!questions.length"> No questions has been added yet! <hr> </div>'),a.put("views/login.html",'<div class="login"> <h1>Login</h1> <form class="login-form"> <p> <div class="input-group"> <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-user" aria-hidden="true"></span></span> <input id="email" type="text" class="form-control" placeholder="Email..." aria-describedby="basic-addon1"> </div> </p> <p> <div class="input-group"> <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></span> <input id="password" type="password" class="form-control" placeholder="Password..." aria-describedby="basic-addon1"> </div> </p> <input type="submit" ng-click="authenticate()" class="btn btn-default" value="Login"> </form> </div>'),a.put("views/main.html",'<div class="jumbotron"> <h2>Main page</h2> </div>'),a.put("views/register.html",'<h2>Register</h2> <form class="register-form"> <p> <div class="input-group"> <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span></span> <input id="email" type="text" class="form-control" placeholder="Type an email..." aria-describedby="basic-addon1"> </div> </p> <p> <div class="input-group"> <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></span> <input id="password" type="password" class="form-control" placeholder="Type a password..." aria-describedby="basic-addon2"> </div> </p> <p> <div class="input-group"> <span class="input-group-addon" id="basic-addon3">Name</span> <input id="name" type="text" class="form-control" aria-describedby="basic-addon3"> </div> </p> <input type="submit" ng-click="signup()" class="btn btn-primary" value="Register"> </form>'),a.put("views/template/navbar.html",'<ul class="nav navbar-nav navbar-right"> <li><a ng-href="#chart">Chart</a></li> <li class="active"><a ng-href="#register">Sign up</a></li> <li><a ng-href="#login">Login</a></li> </ul>'),a.put("views/template/navbarlogged.html",'<ul class="nav navbar-nav navbar-right"> <li><a ng-href="#chart">Chart</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <span class="glyphicon glyphicon-user" aria-hidden="true"><span class="caret"></span></span> </a> <ul class="dropdown-menu"> <li><a href="#logout" ng-click="logout()"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> Log out</a></li> </ul> </li> </ul>')}]);
